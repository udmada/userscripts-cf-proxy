[tools]
node = "lts"
pnpm = "latest"
rust = "stable"

[env]
CARGO_INSTALL_ROOT = "{{config_root}}/.cargo"
PATH = "{{config_root}}/.cargo/bin:{{env.PATH}}"

[tasks.setup]
description = "Install worker-build toolchain"
run = "cargo install worker-build"

[tasks.build]
description = "Build the Rust worker for Cloudflare"
run = "worker-build --release"
depends = ["setup"]

[tasks.deploy]
description = "Deploy all environments to Cloudflare Workers"
run = "pnpm dlx wrangler deploy && pnpm dlx wrangler deploy --env userstyles"

[tasks."deploy:userstyles"]
description = "Deploy userstyles environment only"
run = "pnpm dlx wrangler deploy --env userstyles"
